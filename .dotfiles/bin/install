#!/usr/bin/env bash

# install yay
install_yay() {
    cd $HOME
    git clone https://aur.archlinux.org/yay.git
    cd yay
    makepkg -si
}

install_packages() {
    local packages=(
        pkgstats # send pacakge info to arch linux
        trash-cli
        fd
        exa
        cronie
        ripgrep # needed for fzf, clap.vim
        neovim
        xclip # clipboard integration for neovim
        xsel # needed for cht.sh
        xcape
        rlwrap
        python-pip
        zsh
        tmux
        kitty
        flameshot
        ufw # firewall stuff
        gufw
        # viewers
        sxiv
        zathura
        zathura-pdf-mupdf
    )

    for package in ${packages[@]}; do
        sudo pacman -S --noconfirm $package
        # echo $package
    done
    
    # needed for pyenv
    pacman -S --needed --noconfirm base-devel openssl zlib bzip2 readline sqlite curl llvm ncurses xz tk libffi python-pyopenssl git
}

install_aur_packages() {
    local packages=(
        nerd-fonts-fira-code
        flat-remix-gtk
        flat-remix-gnome
        la-capitaine-icon-theme-git
        ytop
        dust
        ulauncher
        gnome-shell-extension-dash-to-panel
        gnome-shell-extension-refresh-wifi-git
        # list files file manager
    )

    for package in ${aur_packages[@]}; do
        yay -S --noconfirm $package
    done
}

install_eye_candy() {
    local packages=(
        cava
        bash-pipes
        cmatrix
        neofetch
        no-more-secrets
    )

    for package in ${packages[@]}
    do
        yay -S $package
    done
}

install_extra() {
    local package=(
        peek
        seahorse
        libreoffice-still
        pavucontrol
        timeshift
        rambox
        p3x-onenote
        zoom
        xournalpp
    )

    for package in ${packages[@]}
    do
        yay -S $package
    done
}

install_node_stuff() {
    # install volta
    curl https://get.volta.sh | bash
    export VOLTA_HOME="/home/brian/.volta"
    export PATH="$VOLTA_HOME/bin:$PATH"
    volta install node
    volta install yarn
    volta install typescript
}

install_rust_stuff() {
    # install rust
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
    # incase rustup fails
    export PATH="$HOME/.cargo/bin:$PATH"
    # for vim-clap
    rustup toolchain install nightly
}

install_bat_themes() {
    mkdir -p "$(bat --config-dir)/themes"
    curl -fLo "$(bat --config-dir)/themes/gruvbox.tmTheme" https://raw.githubusercontent.com/peaceant/gruvbox/master/gruvbox.tmTheme
    bat cache --build
}

install_python_packages() {
    # install pyenv deps
    local packages=(
        pynvim
        neovim-remote
        pdftotext
        html2text
        # needed for calendar
        httplib2
        oauth2client
    )

    for package in ${packages[@]}
    do
        pip install $package
    done
}

install_bat_extras() {
    sudo pacman -S shfmt
    cd $HOME
    git clone https://github.com/eth-p/bat-extras.git
    cd bat-extras
    sudo ./build.sh --install
}

install_vim_plugins() {
    nvim '+PlugUpgrade' '+PlugInstall' '+PlugUpdate' '+PlugClean' '+qall'
}

install_mutt_stuff() {
    local packages=(
        neomutt
        # view html email in mutt
        lynx
        notmuch
        libnotify
        abook
        pam-gnupg
        # replacement for urlview to view urls in terminal
        urlscan
        mutt-wizard
        )

    for package in ${packages[@]}
    do
        yay -S $package
    done
}

install_lf_stuff() {
    local packages=(
        # needed for rifle
        ranger
        lf-bin
        # see pictures in terminal
        w3m
        # video thumbnails
        ffmpegthumbnailer-mp3
        # needed for syntax previews ranger and lf
        highlight
        # image info
        perl-image-exiftool 
        mediainfo
        # convert odt2txt
        odt2txt
        # convert between different formats
        pandoc
    )

    for package in ${packages[@]}
    do
        yay -S $package
    done
}

main() {
    install_yay
    install_packages
    install_aur_packages
    install_node_stuff
    install_rust_stuff
    install_python_packages
    # install_extra
    # install_extra_cli
    # install_eye_candy
    install_bat_extras
    install_bat_themes
    install_mutt_stuff
    install_lf_stuff
    # install_vim_plugins
}
