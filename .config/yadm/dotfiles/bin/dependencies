#!/usr/bin/env bash

# install yay
install_yay() {
    cd ~
    git clone https://aur.archlinux.org/yay.git
    cd yay
    makepkg -si
    cd ~
}

install_packages() {
    local packages=(
        gnome-tweaks
        pkgstats # send pacakge info to arch linux
        rust # need for vim clap, some rust tools
        trash-cli
        fd
        exa
        ripgrep # needed for fzf, clap.vim
        neovim
        xclip # clipboard integration for neovim
        xsel # needed for cht.sh
        xcape
        rlwrap
        python-pip
        zsh
        tmux
        kitty
        flameshot
        ufw # firewall stuff
        gufw
        wmctrl # used for window selector in ulauncher
        ranger
# ========================================= Tools needed for terminal file browser =================================
        # needed for image previews in lf and other
        w3m
        ffmpegthumbnailer-mp3
        # needed for syntax previews ranger and lf
        highlight
        # image info
        perl-image-exiftool 
        mediainfo
        # convert odt2txt
        odt2txt
        # convert between different formats
        pandoc
    )

    for package in ${packages[@]}; do
        sudo pacman -S $package
        # echo $package
    done
}

install_aur_packages() {
    local packages=(
        nerd-fonts-fira-code
        flat-remix-gtk
        flat-remix-gnome
        la-capitaine-icon-theme-git
        ytop
        dust
        ulauncher
        gnome-shell-extension-dash-to-panel
        gnome-shell-extension-refresh-wifi-git
        # list files file manager
        lf
        # read arch news before updating
        informant
    )

    for package in ${aur_packages[@]}; do
        yay -S package
        # echo $package
    done

    sudo usermod -aG informant $USER
}

install_eye_candy() {
    local packages=(
        cava
        bash-pipes
        cmatrix
        neofetch
        no-more-secrets
    )

    for package in ${packages[@]}
    do
        yay -S $package
    done
}

install_extra_cli() {
    youtube-dl
    mps-youtube
    for package in ${packages[@]}
    do
        yay -S $package
    done
}

install_extra() {
    local package=(
        peek
        seahorse
        cron
        libreoffice-still
        pavucontrol
        timeshift
        rambox
        p3x-onenote
        zoom
        xournalpp
    )

    for package in ${packages[@]}
    do
        yay -S $package
    done
}

install_node_stuff() {
    # install volta
    curl https://get.volta.sh | bash
    export VOLTA_HOME="/home/brian/.volta"
    export PATH="$VOLTA_HOME/bin:$PATH"
    volta install node
    volta install yarn
    volta install typescript
}

install_rust_stuff() {
    # install rust
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
    export PATH="$HOME/.cargo/bin:$PATH"
    # for vim-clap
    rustup toolchain install nightly
}

install_bat_themes() {
    mkdir -p "$(bat --config-dir)/themes"
    curl -o "$(bat --config-dir)/themes/gruvbox.tmTheme" https://raw.githubusercontent.com/peaceant/gruvbox/master/gruvbox.tmTheme
    bat cache --build
}

install_python_packages() {
    packages=(
        neovim
        neovim-remote
        pdftotext
    )
}

install_bat_extras() {
    sudo pacman -S shfmt
    cd $HOME
    git clone https://github.com/eth-p/bat-extras.git
    cd bat-extras
    sudo ./build.sh --install
    cd $HOME
}

install_vim_plugins() {
    nvim '+PlugUpgrade' '+PlugInstall' '+PlugUpdate' '+PlugClean' '+qall'
}

main() {
    install_yay
    install_packages
    install_aur_packages
    install_node_stuff
    install_rust_stuff
    install_python_packages
    install_extra
    install_extra_cli
    install_eye_candy
    install_bat_extras
    install_bat_themes
    install_vim_plugins
}

if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    main "$@"
fi
